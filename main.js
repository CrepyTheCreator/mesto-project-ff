(()=>{"use strict";function e(e){e.classList.add("popup_is-opened"),document.addEventListener("keydown",n)}function t(e){e.classList.remove("popup_is-opened"),document.removeEventListener("keydown",n)}function o(e){e.target.closest(".popup__content")||t(document.querySelector(".popup_is-opened"))}function n(e){if("Escape"===e.key){var o=document.querySelector(".popup_is-opened");if(!o)return;t(o)}}function r(e){var t=e.target,o=t.getAttribute("data-card-id");if(o){var n=t.classList.contains("card__like-button_is-active")?"DELETE":"PUT";t.classList.toggle("card__like-button_is-active"),fetch("https://nomoreparties.co/v1/wff-cohort-35/cards/likes/".concat(o),{method:n,headers:{authorization:"b0c32310-1d90-44c0-955e-865e66a9548d"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){t.closest(".card").querySelector(".card-like-score").textContent=e.likes.length})).catch((function(e){console.error(e)}))}}function c(e,o,n,c,u,i,a){var d=document.querySelector("#card-template").content.querySelector(".card").cloneNode(!0),l=d.querySelector(".card__delete-button");return d.querySelector(".card__title").textContent=e,d.querySelector(".card__image").setAttribute("src",o),d.querySelector(".card__image").setAttribute("alt",e),a&&(d.querySelector(".card-like-score").textContent=a.likes.length),a&&"012852f1f8cef796afa57ed1"!==a.owner._id?(d.querySelector(".card__delete-button").style.display="none",d.querySelector(".card__like-button").dataset.cardId=a._id):a&&a._id&&(d.querySelector(".card__delete-button").dataset.cardId=a._id),d.querySelector(".card__like-button").addEventListener("click",r),l.addEventListener("click",(function(){var e=a._id,o=d;u(i),document.querySelector(".delete-button").addEventListener("click",(function(){return function(e,o,n){e&&o&&fetch("https://nomoreparties.co/v1/wff-cohort-35/cards/".concat(e),{method:"DELETE",headers:{authorization:"b0c32310-1d90-44c0-955e-865e66a9548d"}}).then((function(t){t.ok?(o.remove(),e=null,o=null):console.log("Ошибка при удалении карточки:",t.status)})).catch((function(e){return console.error(e)})),t(n)}(e,o,i)}))})),d.querySelector(".card__image").addEventListener("click",(function(){return c(n,e,o)})),d}var u=function(e,t,o){var n=e.querySelector(".".concat(t.id,"-error"));t.classList.add("form__input_type_error"),n.textContent=o,n.classList.add("form__input-error_active")},i=function(e,t){var o=e.querySelector(".".concat(t.id,"-error"));t.classList.remove("form__input_type_error"),o.classList.remove("form__input-error_active"),o.textContent=""},a=function(e,t){!function(e){return e.some((function(e){return!e.validity.valid}))}(e)?t.disabled=!1:t.disabled=!0};function d(e){var t=e.querySelector(".popup__form");if(t){var o=Array.from(t.querySelectorAll(".popup__input")),n=t.querySelector(".popup__button");o.forEach((function(e){i(t,e)})),a(o,n)}}var l=document.querySelector(".content"),p=l.querySelector(".profile__add-button"),s=l.querySelector(".profile__edit-button"),_=document.querySelector(".popup_type_new-card"),f=document.querySelector(".popup_type_image"),y=l.querySelector(".places__list"),v=document.querySelector(".popup_type_edit"),m=v.querySelector(".popup__input_type_name"),h=v.querySelector(".popup__input_type_description"),S=_.querySelector(".popup__input_type_card-name"),q=_.querySelector(".popup__input_type_url"),k=l.querySelector(".profile__title"),b=l.querySelector(".profile__description"),E=document.querySelector(".profile__image"),L=document.querySelector(".popup_type_delete-card"),g=document.querySelector(".popup_type_upload-avatar");function C(t,o,n){t.querySelector(".popup__caption").textContent=o,t.querySelector(".popup__image").setAttribute("src",n),t.querySelector(".popup__image").setAttribute("alt",o),e(t)}f.querySelector(".popup__close").addEventListener("click",t(f)),_.querySelector(".popup__form").addEventListener("submit",(function(o){o.preventDefault(),fetch("https://nomoreparties.co/v1/wff-cohort-35/cards",{method:"POST",headers:{authorization:"b0c32310-1d90-44c0-955e-865e66a9548d","Content-Type":"application/json"},body:JSON.stringify({name:S.value,link:q.value})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(o){var n=c(o.name,o.link,f,C,e,L,o);y.prepend(n),S.value="",q.value="",t(_)})).catch((function(e){console.error(e)}))})),s.addEventListener("click",(function(){m.value=k.textContent,h.value=b.textContent,d(v),e(v)})),p.addEventListener("click",(function(){d(_),e(_)})),_.querySelector(".popup__close").addEventListener("click",(function(){t(_)})),_.addEventListener("click",(function(e){return o(e)})),v.querySelector(".popup__close").addEventListener("click",(function(){return t(v)})),v.querySelector(".popup__form").addEventListener("submit",(function(e){e.preventDefault();var o=v.querySelector(".popup__input_type_name"),n=v.querySelector(".popup__input_type_description");!function(e,o){var n=v.querySelector(".popup__button");n.textContent="Сохранение...",fetch("https://nomoreparties.co/v1/wff-cohort-35/users/me",{method:"PATCH",headers:{authorization:"b0c32310-1d90-44c0-955e-865e66a9548d","Content-Type":"application/json"},body:JSON.stringify({name:e,about:o})}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){document.querySelector(".profile__title").textContent=e.name,document.querySelector(".profile__description").textContent=e.about})).catch((function(e){console.error(e),alert("Произошла ошибка при сохранении данных. Попробуйте снова.")})).finally((function(){t(v),n.textContent="Сохранить"}))}(o.value,n.value)})),v.addEventListener("click",(function(e){return o(e)})),f.querySelector(".popup__close").addEventListener("click",(function(){return t(f)})),f.addEventListener("click",(function(e){return o(e)})),L.querySelector(".popup__close").addEventListener("click",(function(){return t(L)})),L.addEventListener("click",(function(e){return o(e)})),document.querySelector(".profile__image").addEventListener("click",(function(){return e(g)})),g.querySelector(".popup__close").addEventListener("click",(function(){return t(g)})),g.addEventListener("click",(function(e){return o(e)})),g.querySelector(".avatar-button").addEventListener("click",(function(){return function(e,o){var n=e.querySelector(".popup__input_type_upload-avatar").value;fetch("https://nomoreparties.co/v1/wff-cohort-35/users/me/avatar",{method:"PATCH",headers:{authorization:"b0c32310-1d90-44c0-955e-865e66a9548d","Content-Type":"application/json"},body:JSON.stringify({avatar:n})}),o.style.backgroundImage="url('".concat(n,"')"),t(e)}(g,E)})),Array.from(document.querySelectorAll(".popup__form")).forEach((function(e){e.addEventListener("submit",(function(e){e.preventDefault()})),function(e){var t=Array.from(e.querySelectorAll(".popup__input")),o=e.querySelector(".popup__button");a(t,o),t.forEach((function(n){n.addEventListener("input",(function(){!function(e,t){t.validity.valid?"link"===t.id||"avatar-link"===t.id||/^[a-zA-Zа-яА-ЯёЁ -]+$/.test(t.value)?i(e,t):u(e,t,"Разрешены только латинские, кириллические буквы, знаки дефиса и пробелы"):u(e,t,t.validationMessage)}(e,n),a(t,o)}))}))}(e)})),addEventListener("DOMContentLoaded",(function(){fetch("https://nomoreparties.co/v1/wff-cohort-35/users/me",{method:"GET",headers:{authorization:"b0c32310-1d90-44c0-955e-865e66a9548d"}}).then((function(e){return e.json()})).then((function(e){k.textContent=e.name,b.textContent=e.about,E.style.backgroundImage="url('".concat(e.avatar,"')")})),fetch("https://nomoreparties.co/v1/wff-cohort-35/cards",{method:"GET",headers:{authorization:"b0c32310-1d90-44c0-955e-865e66a9548d"}}).then((function(e){return e.json()})).then((function(t){for(var o=0;o<t.length;o++){var n=c(t[o].name,t[o].link,f,C,e,L,t[o]);y.append(n)}})),fetch("https://nomoreparties.co/v1/wff-cohort-35/cards",{headers:{authorization:"b0c32310-1d90-44c0-955e-865e66a9548d"}}).then((function(e){return e.ok?e.json():Promise.reject("Ошибка: ".concat(e.status))})).then((function(e){console.log(e),e.forEach((function(e){if(e.likes.some((function(e){return"012852f1f8cef796afa57ed1"===e._id}))){var t=document.querySelector('[data-card-id="'.concat(e._id,'"]'));t&&(t.classList.add("card__like-button_is-active"),t.closest(".card").querySelector(".card-like-score").textContent=e.likes.length)}}))})).catch((function(e){console.error(e)}))}))})();